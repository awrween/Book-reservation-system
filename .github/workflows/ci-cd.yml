name: CI/CD Pipeline

on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      # Step 1: Checkout repository
      - name: Checkout repository
        uses: actions/checkout@v2

      # Step 2: Set up Node.js environment
      - name: Set up Node.js
        uses: actions/setup-node@v2
        with:
          node-version: '16'  # Adjust node version as per your project needs

      # Step 3: Install backend dependencies
      - name: Install dependencies for Backend
        run: |
          cd backend
          npm ci  # Use npm ci for clean install in CI/CD

      # Step 4: Start Backend Server
      - name: Run Backend Server
        run: |
          cd backend
          nohup npm start > server.log 2>&1 &  # Run the backend server in the background
          tail -f server.log  # Logs the backend server's output to GitHub Actions logs for debugging

      # Step 5: Install frontend dependencies
      - name: Install dependencies for Frontend
        run: |
          cd frontend
          npm ci  # Clean install for frontend dependencies

      # Step 6: Build frontend for production
      - name: Build Frontend
        run: |
          cd frontend
          npm run build  # Build the frontend for production

      # Step 7: Start Frontend Server
      - name: Start Frontend Server
        run: |
          cd frontend
          nohup npm start > frontend.log 2>&1 &  # Start frontend server in the background
          tail -f frontend.log  # Logs the frontend server's output to GitHub Actions logs for debugging

      # Step 8: Deployment Complete
      - name: Deployment complete
        run: echo "Deployment completed successfully!"

  # Optional: Run Tests
  test:
    runs-on: ubuntu-latest
    steps:
      # Checkout the repository
      - name: Checkout repository
        uses: actions/checkout@v2

      # Set up Node.js environment for testing
      - name: Set up Node.js
        uses: actions/setup-node@v2
        with:
          node-version: '16'

      # Install dependencies for backend testing
      - name: Install dependencies for Backend
        run: |
          cd backend
          npm ci

      # Run backend tests
      - name: Run Backend Tests
        run: |
          cd backend
          npm test  # Replace with your backend test command

      # Install dependencies for frontend testing
      - name: Install dependencies for Frontend
        run: |
          cd frontend
          npm ci

      # Run frontend tests
      - name: Run Frontend Tests
        run: |
          cd frontend
          npm test  # Replace with your frontend test command


            

